"use strict";(self.webpackChunkdevelopers_boruta=self.webpackChunkdevelopers_boruta||[]).push([[9605],{10511:(e,t,r)=>{r.d(t,{A:()=>a});const a=r.p+"assets/images/authorization-gateway-en-e7f93cd130db32c8917f1193f371f32b.png"},15680:(e,t,r)=>{r.d(t,{xA:()=>u,yg:()=>h});var a=r(96540);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var c=a.createContext({}),p=function(e){var t=a.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=p(e.components);return a.createElement(c.Provider,{value:t},e.children)},l="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),l=p(r),d=n,h=l["".concat(c,".").concat(d)]||l[d]||g[d]||o;return r?a.createElement(h,i(i({ref:t},u),{},{components:r})):a.createElement(h,i({ref:t},u))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[l]="string"==typeof e?e:n,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},43135:(e,t,r)=>{r.d(t,{A:()=>a});const a=r.p+"assets/images/boruta-microgateway-ca27b997f3ebaeb6fdddf7a75814a48d.png"},64242:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var a=r(58168),n=(r(96540),r(15680));const o={},i="Upstreams configuration",s={unversionedId:"provider-configuration/configure-upstreams",id:"provider-configuration/configure-upstreams",title:"Upstreams configuration",description:"Note that the gateway is experimental and might not be fully functional for production yet.",source:"@site/docs/provider-configuration/configure-upstreams.md",sourceDirName:"provider-configuration",slug:"/provider-configuration/configure-upstreams",permalink:"/developers.boruta/docs/provider-configuration/configure-upstreams",draft:!1,editUrl:"https://github.com/malach-it/developers.boruta/tree/master/docs/provider-configuration/configure-upstreams.md",tags:[],version:"current",frontMatter:{},sidebar:"borutaSidebar",previous:{title:"Global configuration | Configuration files",permalink:"/developers.boruta/docs/provider-configuration/configuration/configuration-files"},next:{title:"Verifiable Credentials Decentralized Status",permalink:"/developers.boruta/docs/drafts/vc-decentralized-status"}},c={},p=[{value:"Upstream configuration",id:"upstream-configuration",level:2},{value:"Authorization",id:"authorization",level:3},{value:"Microgateway / Sidecars",id:"microgateway--sidecars",level:2},{value:"Manage through User Interface",id:"manage-through-user-interface",level:2},{value:"Manage through API",id:"manage-through-api",level:2}],u={toc:p},l="wrapper";function g(e){let{components:t,...o}=e;return(0,n.yg)(l,(0,a.A)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,n.yg)("h1",{id:"upstreams-configuration"},"Upstreams configuration"),(0,n.yg)("admonition",{title:"experimental feature",type:"note"},(0,n.yg)("p",{parentName:"admonition"},"Note that the gateway is experimental and might not be fully functional for production yet.")),(0,n.yg)("p",null,"Upstreams are here the configuration of the flow the gateway will apply for requests to be ",(0,n.yg)("strong",{parentName:"p"},"forwarded to backends"),". Corresponding to given paths, the gateway will ",(0,n.yg)("strong",{parentName:"p"},"route the requests")," to the configured server. More than routing capabilities, boruta ",(0,n.yg)("strong",{parentName:"p"},"enhance the requests")," with the current client and user information but also can ",(0,n.yg)("strong",{parentName:"p"},"apply authorization")," to them."),(0,n.yg)("h2",{id:"upstream-configuration"},"Upstream configuration"),(0,n.yg)("p",null,"boruta runs a pool of connections to the upstreamed backend. To configure those you have to provide the ",(0,n.yg)("inlineCode",{parentName:"p"},"scheme"),", the ",(0,n.yg)("inlineCode",{parentName:"p"},"host"),", and the ",(0,n.yg)("inlineCode",{parentName:"p"},"port")," for it to know which server forward to."),(0,n.yg)("p",null,"The gateway will ",(0,n.yg)("strong",{parentName:"p"},"expose a single entrypoint"),", in order to route to the servers, the ",(0,n.yg)("strong",{parentName:"p"},"routing")," is based on the requested path computed by priority. you can provide them filling the ",(0,n.yg)("inlineCode",{parentName:"p"},"URIs")," fields. Note that you can strip URI meaning that the provided URI part will not be forwarded to the backend."),(0,n.yg)("h3",{id:"authorization"},"Authorization"),(0,n.yg)("p",null,"You have the ability to ",(0,n.yg)("strong",{parentName:"p"},"provide authorization to the requests"),", enforcing clients to have a valid access token. On top of that you can forbid access requiring it to have the needed method / OAuth scope couple. While authorizing, you can customize the unauthorized and forbidden response templates and content-type."),(0,n.yg)("p",null,"The authorized requests are ",(0,n.yg)("strong",{parentName:"p"},"enhanced with current request information")," providing a ",(0,n.yg)("inlineCode",{parentName:"p"},"X-Forwarded-Authorization")," header to the backend with a JWT incorporating client and user information. Those are to be signed with the given algorithm and secrets."),(0,n.yg)("p",null,(0,n.yg)("img",{alt:"Gateway authorization flow",src:r(10511).A,width:"1337",height:"569"})),(0,n.yg)("h2",{id:"microgateway--sidecars"},"Microgateway / Sidecars"),(0,n.yg)("p",null,(0,n.yg)("strong",{parentName:"p"},"More than a single gateway"),", boruta can act as a microgateway. Using infrastructure to connect boruta instances together, you ",(0,n.yg)("strong",{parentName:"p"},"can have sidecars")," connected to one or some of your backends. You can choose the active node configuration with the ",(0,n.yg)("inlineCode",{parentName:"p"},"Node")," attribute of upstreams. It will use the instance ip as default but can be edited with the usage of static configuration (see below). Note that the gateway and the microgateway will respectively exposed on the ports set by ",(0,n.yg)("inlineCode",{parentName:"p"},"BORUTA_GATEWAY_PORT")," and ",(0,n.yg)("inlineCode",{parentName:"p"},"BORUTA_GATEWAY_SIDECAR_PORT")," environment variables."),(0,n.yg)("p",null,(0,n.yg)("img",{alt:"microgateways",src:r(43135).A,width:"723",height:"370"})),(0,n.yg)("h2",{id:"manage-through-user-interface"},"Manage through User Interface"),(0,n.yg)("p",null,'The Administration interface gives the ability to create, update and delete upstreams. All upstream attributes are accessible via the captured form below. All these operations can be managed in the "Upstreams" section in the sidebar menu.'),(0,n.yg)("p",null,(0,n.yg)("img",{alt:"upstream view",src:r(88202).A,width:"562",height:"216"})),(0,n.yg)("h2",{id:"manage-through-api"},"Manage through API"),(0,n.yg)("p",null,"All upstream operations are accessible through a REST API following the below description. All upstream management endpoints are protected with a Bearer token that can be obtained with any OAuth flow. In order to get access, you need to have an access token with the ",(0,n.yg)("a",{parentName:"p",href:"/developers.boruta/docs/provider-configuration/configure-scopes#public-vs-private-scopes"},"private")," scope ",(0,n.yg)("inlineCode",{parentName:"p"},"upstreams:manage:all")," granted."),(0,n.yg)("blockquote",null,(0,n.yg)("p",{parentName:"blockquote"},"Have a look at ",(0,n.yg)("a",{parentName:"p",href:"/api/list-upstreams"},"API documentation"))))}g.isMDXComponent=!0},88202:(e,t,r)=>{r.d(t,{A:()=>a});const a=r.p+"assets/images/upstreams-list-fc8712a0ce9e8ffb382811958446c27c.png"}}]);